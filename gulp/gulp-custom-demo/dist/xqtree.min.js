"use strict";function _objectSpread(t){for(var e=1;e<arguments.length;e++)if(e%2){var n=null!=arguments[e]?arguments[e]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),o.forEach(function(e){_defineProperty(t,e,n[e])})}else Object.defineProperties(t,Object.getOwnPropertyDescriptors(arguments[e]));return t}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(e,t){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.xqTree=t()}(window,function(){var o={onClick:function(){},onCheck:function(){}},f={_id:"",open:!1,checked:!1,checkedPart:!1};function N(e,t,n){if(e!==Object(e))throw new Error("xqTree需要一个元素容器");this.element=e,this.originalNodes=n,this.config=_objectSpread({},o,{},t),this.nodes={},N.type.isArray(n)&&0<n.length&&this.setNodes(n)}function k(e,t,n){return function(e,t,n){n=n.split("_")[3];var o="tree_"+t+"_"+n+"_";if(""===e._id){var r=Object.keys(this.nodes).filter(function(e){return-1<e.indexOf(o)});e._id=o+(r.length+1)}return this.nodes[e._id]=e}.call(this,e,t,n)._id}N.forEach=function(e,t){Array.prototype.forEach.call(e,t)},N.type=function(e){return Object.prototype.toString.call(e).match(/\[object (.*?)\]/)[1].toLowerCase()},["Null","Undefined","Object","Array","String","Number","Boolean","Function","RegExp"].forEach(function(t){N.type["is"+t]=function(e){return N.type(e)===t.toLowerCase()}}),N.prototype.setNodes=function(e){var t=function a(e,h,l){var p=this;h=h||0;l=l||"tree_0_0_0";var u=y.ul(h);e.forEach(function(e){e=Object.assign({},f,e);var t=k.call(p,e,h,l),n=y.li(h,e),o=y.spanCheckbox(),r=y.aLink(),i=y.spanIcon(),c=y.spanText(e.name),s=y.spanSwitch();if(n.append(o),n.append(r),r.append(i,c),N.type.isArray(e.children)&&0<e.children.length){var d=a.call(p,e.children,h+1,t);d.style.height=e.open?"auto":"0",n.append(s),n.append(d)}u.append(n)});return u}.call(this,e);this.element.append(t),function(){var o=this;function t(e){var t=this.parentNode,n=o.getNodeObj(t);n.checked&&!n.checkedPart?o.setNodeNoChecked(t):o.setNodeChecked(t),o.config.onCheck(e,n)}function n(e){var t=this.parentNode,n=o.getNodeObj(t);n.open?o.setNodeClose(t):o.setNodeOpen(t),o.config.onClick(e,n)}Array.prototype.forEach.call(this.element.getElementsByClassName("xqtree-node-checkbox"),function(e){e.addEventListener("click",t,!1)}),Array.prototype.forEach.call(this.element.getElementsByClassName("xqtree-node-link"),function(e){e.addEventListener("click",n,!1)})}.call(this)},N.prototype.setNodeOpen=function(e){var t=e.lastChild;if("UL"===t.nodeName){var n=t.previousSibling;n.previousSibling.classList.add("xqtree-node-link-open"),n.classList.remove("xqtree-node-switch-close"),n.classList.add("xqtree-node-switch-open"),this.nodes[e.id].open=!0;var o=this.getNodeOpenHeight(e);t.style.height=o+"px",this.setNodeParentOpen(e,o)}},N.prototype.setNodeParentOpen=function(e,t){var n=e.parentNode;if("false"===n.getAttribute("root")){var o=n.clientHeight+t;n.style.height=o+"px",this.setNodeParentOpen(n.parentNode,t)}},N.prototype.setNodeClose=function(e){var t=e.lastChild;if("UL"===t.nodeName){var n=t.previousSibling;n.previousSibling.classList.remove("xqtree-node-link-open"),n.classList.remove("xqtree-node-switch-open"),n.classList.add("xqtree-node-switch-close"),this.nodes[e.id].open=!1;var o=t.clientHeight;t.style.height="0px",this.setNodeParentClose(e,o)}},N.prototype.setNodeParentClose=function(e,t){var n=e.parentNode;if("false"===n.getAttribute("root")){var o=n.clientHeight-t;n.style.height=o+"px",this.setNodeParentClose(n.parentNode,t)}},N.prototype.getNodeOpenHeight=function(e){var t=e.lastChild,n=0;return"UL"===t.nodeName&&this.nodes[e.id].open&&N.forEach(t.children,function(e){n+=e.clientHeight}),n},N.prototype.setNodeChecked=function(e){this.setNodeCheckedStatus(e,!0,!1),"UL"===e.lastChild.nodeName&&this.setNodeChildChecked(e),"UL"===e.parentNode.nodeName&&"false"===e.parentNode.getAttribute("root")&&this.setNodeParentCheckedStatus(e)},N.prototype.setNodeChildChecked=function(e){var t=this,n=e.lastChild;"UL"===n.nodeName&&N.forEach(n.children,function(e){t.setNodeCheckedStatus(e,!0,!1),t.setNodeChildChecked(e)})},N.prototype.setNodeParentCheckedStatus=function(e){var t=e.parentNode;if("UL"===t.nodeName&&"false"===t.getAttribute("root")){var n=t.parentNode,o=this.getNodeCheckedStatus(n);this.setNodeCheckedStatus(n,o.checked,o.checkedPart),this.setNodeParentCheckedStatus(n)}},N.prototype.setNodeNoChecked=function(e){this.setNodeCheckedStatus(e,!1,!1),"UL"===e.lastChild.nodeName&&this.setNodeChildNoChecked(e),"UL"===e.parentNode.nodeName&&"false"===e.parentNode.getAttribute("root")&&this.setNodeParentCheckedStatus(e)},N.prototype.setNodeChildNoChecked=function(e){var t=this,n=e.lastChild;"UL"===n.nodeName&&N.forEach(n.children,function(e){t.setNodeCheckedStatus(e,!1,!1),t.setNodeChildNoChecked(e)})},N.prototype.setNodeCheckedStatus=function(e,t,n){var o=e.firstChild;o.classList.remove("xqtree-node-checkbox-select-false"),o.classList.remove("xqtree-node-checkbox-select-part"),o.classList.remove("xqtree-node-checkbox-select-true"),this.nodes[e.id].checkedPart=t&&!n?(o.classList.add("xqtree-node-checkbox-select-true"),!(this.nodes[e.id].checked=!0)):t&&n?(o.classList.add("xqtree-node-checkbox-select-part"),this.nodes[e.id].checked=!0):(o.classList.add("xqtree-node-checkbox-select-false"),this.nodes[e.id].checked=!1)},N.prototype.getNodeCheckedStatus=function(e){var n=this,t=e.lastChild,o={checked:!0,checkedPart:!1};if("UL"===t.nodeName){var r=0,i=0;N.forEach(t.children,function(e){var t=n.getNodeObj(e);t.checked&&(r++,t.checkedPart&&i++)}),0===r?(o.checked=!1,o.checkedPart=!1):r===t.childElementCount&&0===i?(o.checked=!0,o.checkedPart=!1):(o.checked=!0,o.checkedPart=!0)}return o},N.prototype.getNodeObj=function(e){return this.nodes[e.id]};var y={ul:function(e){var t=document.createElement("ul");return 0===e&&t.classList.add("xqtree"),t.setAttribute("root",0===e),t},li:function(e,t){var n=document.createElement("li");return n.id=t._id,n.classList.add("xqtree-node"),n.setAttribute("level",e),n},spanCheckbox:function(){return this.span("xqtree-node-checkbox","xqtree-node-checkbox-select-false")},aLink:function(){var e=document.createElement("a");return e.classList.add("xqtree-node-link"),e.href="javascript:void(0)",e},spanIcon:function(){return this.span("xqtree-node-link-icon")},spanText:function(e){var t=this.span("xqtree-node-link-text");return t.innerText=e,t},spanSwitch:function(){return this.span("xqtree-node-switch","xqtree-node-switch-close")},span:function(){var e,t=document.createElement("span");return(e=t.classList).add.apply(e,arguments),t}};return N});
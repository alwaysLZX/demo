"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(e,t){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.xqTree=t()}(window,function(){var n={},f={_id:"",open:!1,checked:!1,checkedPart:!1};function N(e,t,o){if(e!==Object(e))throw new Error("xqTree需要一个元素容器");this.element=e,this.originalNodes=o,this.config=Object.assign({},n,t),this.nodes={},N.type.isArray(o)&&0<o.length&&this.setNodes(o)}function k(e,t,o){return function(e,t,o){o=o.split("_")[3];var n="tree_"+t+"_"+o+"_";if(""===e._id){var i=Object.keys(this.nodes).filter(function(e){return-1<e.indexOf(n)});e._id=n+(i.length+1)}return this.nodes[e._id]=e}.call(this,e,t,o)._id}N.forEach=function(e,t){Array.prototype.forEach.call(e,t)},N.type=function(e){return Object.prototype.toString.call(e).match(/\[object (.*?)\]/)[1].toLowerCase()},["Null","Undefined","Object","Array","String","Number","Boolean","Function","RegExp"].forEach(function(t){N.type["is"+t]=function(e){return N.type(e)===t.toLowerCase()}}),N.prototype.setNodes=function(e){var t=function a(e,h,l){var p=this;h=h||0;l=l||"tree_0_0_0";var u=y.ul(h);e.forEach(function(e){e=Object.assign({},f,e);var t=k.call(p,e,h,l),o=y.li(h,e),n=y.spanCheckbox(),i=y.aLink(),s=y.spanIcon(),r=y.spanText(e.name),c=y.spanSwitch();if(o.append(n),o.append(i),i.append(s,r),N.type.isArray(e.children)&&0<e.children.length){var d=a.call(p,e.children,h+1,t);d.style.height=e.open?"auto":"0",o.append(c),o.append(d)}u.append(o)});return u}.call(this,e);this.element.append(t),function(){var o=this;function t(e){var t=this.parentNode;o.nodes[t.id].checked?o.setNodeNoChecked(t):o.setNodeChecked(t)}function n(e){var t=this.parentNode;o.nodes[t.id].open?o.setNodeClose(t):o.setNodeOpen(t)}Array.prototype.forEach.call(this.element.getElementsByClassName("xqtree-node-checkbox"),function(e){e.addEventListener("click",t,!1)}),Array.prototype.forEach.call(this.element.getElementsByClassName("xqtree-node-link"),function(e){e.addEventListener("click",n,!1)})}.call(this)},N.prototype.setNodeOpen=function(e){var t=e.lastChild;if("UL"===t.nodeName){var o=t.previousSibling;o.previousSibling.classList.add("xqtree-node-link-open"),o.classList.remove("xqtree-node-switch-close"),o.classList.add("xqtree-node-switch-open"),this.nodes[e.id].open=!0;var n=this.getNodeOpenHeight(e);t.style.height=n+"px",this.setNodeParentOpen(e,n)}},N.prototype.setNodeParentOpen=function(e,t){var o=e.parentNode;if("false"===o.getAttribute("root")){var n=o.clientHeight+t;o.style.height=n+"px",this.setNodeParentOpen(o.parentNode,t)}},N.prototype.setNodeClose=function(e){var t=e.lastChild;if("UL"===t.nodeName){var o=t.previousSibling;o.previousSibling.classList.remove("xqtree-node-link-open"),o.classList.remove("xqtree-node-switch-open"),o.classList.add("xqtree-node-switch-close"),this.nodes[e.id].open=!1;var n=t.clientHeight;t.style.height="0px",this.setNodeParentClose(e,n)}},N.prototype.setNodeParentClose=function(e,t){var o=e.parentNode;if("false"===o.getAttribute("root")){var n=o.clientHeight-t;o.style.height=n+"px",this.setNodeParentClose(o.parentNode,t)}},N.prototype.getNodeOpenHeight=function(e){var t=e.lastChild,o=0;return"UL"===t.nodeName&&this.nodes[e.id].open&&N.forEach(t.children,function(e){o+=e.clientHeight}),o},N.prototype.setNodeChecked=function(e){this.setNodeCheckedStatus(e,!0,!1),"UL"===e.lastChild.nodeName&&this.setNodeChildChecked(e),"UL"===e.parentNode.nodeName&&"false"===e.parentNode.getAttribute("root")&&this.setNodeParentChecked(e)},N.prototype.setNodeChildChecked=function(e){var t=this,o=e.lastChild;"UL"===o.nodeName&&N.forEach(o.children,function(e){t.setNodeCheckedStatus(e,!0,!1),t.setNodeChildChecked(e)})},N.prototype.setNodeParentChecked=function(e){var t=e.parentNode;if("UL"===t.nodeName&&"false"===t.getAttribute("root")){var o=t.parentNode,n=this.getNodeCheckedStatus(o);this.setNodeCheckedStatus(o,n.checked,n.checkedPart),this.setNodeParentChecked(o)}},N.prototype.setNodeNoChecked=function(e){var t=e.firstChild;t.classList.add("xqtree-node-checkbox-select-false"),t.classList.remove("xqtree-node-checkbox-select-part"),t.classList.remove("xqtree-node-checkbox-select-true"),this.nodes[e.id].checked=!1,"UL"===e.lastChild.nodeName&&this.setNodeChildNoChecked(e)},N.prototype.setNodeChildNoChecked=function(e){var t=this,o=e.lastChild;"UL"===o.nodeName&&N.forEach(o.children,function(e){t.setNodeNoChecked(e)})},N.prototype.setNodeCheckedStatus=function(e,t,o){var n=e.firstChild;n.classList.remove("xqtree-node-checkbox-select-false"),n.classList.remove("xqtree-node-checkbox-select-part"),n.classList.remove("xqtree-node-checkbox-select-true"),this.nodes[e.id].checkedPart=t&&!o?(n.classList.add("xqtree-node-checkbox-select-true"),!(this.nodes[e.id].checked=!0)):t&&o?(n.classList.add("xqtree-node-checkbox-select-part"),this.nodes[e.id].checked=!0):(n.classList.add("xqtree-node-checkbox-select-false"),this.nodes[e.id].checked=!1)},N.prototype.getNodeCheckedStatus=function(e){var o=this,t=e.lastChild,n={checked:!0,checkedPart:!1};if("UL"===t.nodeName){var i=0,s=0;N.forEach(t.children,function(e){var t=o.getNodeObj(e);t.checked&&(i++,t.checkedPart&&s++)}),0===i?n.checked=!1:i<t.childElementCount?n.checkedPart=!0:n.checkedPart=0<s||!(n.checked=!0)}return n},N.prototype.getNodeObj=function(e){return this.nodes[e.id]};var y={ul:function(e){var t=document.createElement("ul");return 0===e&&t.classList.add("xqtree"),t.setAttribute("root",0===e),t},li:function(e,t){var o=document.createElement("li");return o.id=t._id,o.classList.add("xqtree-node"),o.setAttribute("level",e),o},spanCheckbox:function(){return this.span("xqtree-node-checkbox","xqtree-node-checkbox-select-false")},aLink:function(){var e=document.createElement("a");return e.classList.add("xqtree-node-link"),e.href="javascript:void(0)",e},spanIcon:function(){return this.span("xqtree-node-link-icon")},spanText:function(e){var t=this.span("xqtree-node-link-text");return t.innerText=e,t},spanSwitch:function(){return this.span("xqtree-node-switch","xqtree-node-switch-close")},span:function(){var e,t=document.createElement("span");return(e=t.classList).add.apply(e,arguments),t}};return N});
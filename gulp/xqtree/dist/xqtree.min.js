"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(e,t){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.xqTree=t()}(window,function(){var o={},f={_id:"",open:!1,checked:!1};function y(e,t,n){if(e!==Object(e))throw new Error("xqTree需要一个元素容器");this.element=e,this.originalNodes=n,this.config=Object.assign({},o,t),this.nodes={},y.type.isArray(n)&&0<n.length&&this.setNodes(n)}function N(e,t,n){return function(e,t,n){n=n.split("_")[3];var o="tree_"+t+"_"+n+"_";if(""===e._id){var i=Object.keys(this.nodes).filter(function(e){return-1<e.indexOf(o)});e._id=o+(i.length+1)}return this.nodes[e._id]=e}.call(this,e,t,n)._id}y.forEach=function(e,t){Array.prototype.forEach.call(e,t)},y.type=function(e){return Object.prototype.toString.call(e).match(/\[object (.*?)\]/)[1].toLowerCase()},["Null","Undefined","Object","Array","String","Number","Boolean","Function","RegExp"].forEach(function(t){y.type["is"+t]=function(e){return y.type(e)===t.toLowerCase()}}),y.prototype.setNodes=function(e){var t=function a(e,l,h){var p=this;l=l||0;h=h||"tree_0_0_0";var u=v.ul(l);e.forEach(function(e){e=Object.assign({},f,e);var t=N.call(p,e,l,h),n=v.li(l,e),o=v.spanCheckbox(),i=v.aLink(),s=v.spanIcon(),r=v.spanText(e.name),c=v.spanSwitch();if(n.append(o),n.append(i),i.append(s,r),y.type.isArray(e.children)&&0<e.children.length){var d=a.call(p,e.children,l+1,t);d.style.height=e.open?"auto":"0",n.append(c),n.append(d)}u.append(n)});return u}.call(this,e);this.element.append(t),function(){var n=this;function t(e){var t=this.parentNode;n.nodes[t.id].checked?n.setNodesNoChecked(t):n.setNodesChecked(t)}function o(e){var t=this.parentNode;n.nodes[t.id].open?n.setNodeClose(t):n.setNodeOpen(t)}Array.prototype.forEach.call(this.element.getElementsByClassName("xqtree-node-checkbox"),function(e){e.addEventListener("click",t,!1)}),Array.prototype.forEach.call(this.element.getElementsByClassName("xqtree-node-link"),function(e){e.addEventListener("click",o,!1)})}.call(this)},y.prototype.setNodeOpen=function(e){var t=e.lastChild;if("UL"===t.nodeName){var n=t.previousSibling;n.previousSibling.classList.add("xqtree-node-link-open"),n.classList.remove("xqtree-node-switch-close"),n.classList.add("xqtree-node-switch-open"),this.nodes[e.id].open=!0;var o=this.getNodeOpenHeight(e);t.style.height=o+"px",this.setNodeParentOpen(e,o)}},y.prototype.setNodeParentOpen=function(e,t){var n=e.parentNode;if("false"===n.getAttribute("root")){var o=n.clientHeight+t;n.style.height=o+"px",this.setNodeParentOpen(n.parentNode,t)}},y.prototype.setNodeClose=function(e){var t=e.lastChild;if("UL"===t.nodeName){var n=t.previousSibling;n.previousSibling.classList.remove("xqtree-node-link-open"),n.classList.remove("xqtree-node-switch-open"),n.classList.add("xqtree-node-switch-close"),this.nodes[e.id].open=!1;var o=t.clientHeight;t.style.height="0px",this.setNodeParentClose(e,o)}},y.prototype.setNodeParentClose=function(e,t){var n=e.parentNode;if("false"===n.getAttribute("root")){var o=n.clientHeight-t;n.style.height=o+"px",this.setNodeParentClose(n.parentNode,t)}},y.prototype.getNodeOpenHeight=function(e){var t=e.lastChild,n=0;return"UL"===t.nodeName&&this.nodes[e.id].open&&y.forEach(t.children,function(e){n+=e.clientHeight}),n},y.prototype.setNodesChecked=function(e){var t=e.firstChild;t.classList.remove("xqtree-node-checkbox-select-false"),t.classList.remove("xqtree-node-checkbox-select-part"),t.classList.add("xqtree-node-checkbox-select-true"),this.nodes[e.id].checked=!0,"UL"===e.lastChild.nodeName&&this.setNodesChildChecked(e)},y.prototype.setNodesChildChecked=function(e){var t=this,n=e.lastChild;"UL"===n.nodeName&&y.forEach(n.children,function(e){t.setNodesChecked(e)})},y.prototype.setNodesParentChecked=function(e){var t=this,n=e.lastChild;"UL"===n.nodeName&&y.forEach(n.children,function(e){t.setNodesChecked(e)})},y.prototype.setNodesNoChecked=function(e){var t=e.firstChild;t.classList.add("xqtree-node-checkbox-select-false"),t.classList.remove("xqtree-node-checkbox-select-part"),t.classList.remove("xqtree-node-checkbox-select-true"),this.nodes[e.id].checked=!1,"UL"===e.lastChild.nodeName&&this.setNodesChildNoChecked(e)},y.prototype.setNodesChildNoChecked=function(e){var t=this,n=e.lastChild;"UL"===n.nodeName&&y.forEach(n.children,function(e){t.setNodesNoChecked(e)})};var v={ul:function(e){var t=document.createElement("ul");return 0===e&&t.classList.add("xqtree"),t.setAttribute("root",0===e),t},li:function(e,t){var n=document.createElement("li");return n.id=t._id,n.classList.add("xqtree-node"),n.setAttribute("level",e),n},spanCheckbox:function(){return this.span("xqtree-node-checkbox","xqtree-node-checkbox-select-false")},aLink:function(){var e=document.createElement("a");return e.classList.add("xqtree-node-link"),e.href="javascript:void(0)",e},spanIcon:function(){return this.span("xqtree-node-link-icon")},spanText:function(e){var t=this.span("xqtree-node-link-text");return t.innerText=e,t},spanSwitch:function(){return this.span("xqtree-node-switch","xqtree-node-switch-close")},span:function(){var e,t=document.createElement("span");return(e=t.classList).add.apply(e,arguments),t}};return y});